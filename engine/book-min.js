var PBS;if(!PBS){PBS={}}if(!PBS.KIDS){PBS.KIDS={}}PBS.KIDS.storybook=function(GLOBAL){"use strict";var that={};that.log=function(message){if(GLOBAL.console){GLOBAL.console.log(message)}},that.error=function(message){if(GLOBAL.console){GLOBAL.console.log("ERROR: "+message)}};that.debug=function(message){if(GLOBAL.console){GLOBAL.console.log("DEBUG: "+message)}};that.createCanvas=function(parentElement,options){var canvasElement=GLOBAL.document.createElement("canvas");if(options.id){canvasElement.id=options.id}if(options.className){canvasElement.className=options.className}if(options.width){canvasElement.width=options.width}if(options.height){canvasElement.height=options.height}if(parentElement){parentElement.appendChild(canvasElement)}return canvasElement.getContext("2d")};that.getElementPosition=function(element){var parentOffset,pos={x:element.offsetLeft,y:element.offsetTop};if(element.offsetParent){parentOffset=that.getElementPosition(element.offsetParent);pos.x+=parentOffset.x;pos.y+=parentOffset.y}return pos};that.distance=function(p1,p2){var dx=p1.x-p2.x,dy=p1.y-p2.y;return Math.sqrt(dx*dx+dy*dy)};that.getNumberFromString=function(param){if(param===undefined){return}else if(typeof param!=="string"){param=param.toString()}return param.replace(/[^-\d\.]/g,"")};that.isInPixelUnits=function(param){return param.toString().toUpperCase().indexOf("PX")!==-1};that.isInPercentageUnits=function(param){return param.toString().indexOf("%")!==-1};that.removeAllChildren=function(element){var i,numChildren=element.childNodes.length;for(i=0;i<numChildren;i+=1){element.removeChild(element.childNodes[element.childNodes.length-1])}};return that}(window);PBS.KIDS.storybook.eventDispatcher=function(){"use strict";var that={},eventListeners={};that.addEventListener=function(eventName,listener){if(eventListeners[eventName]===undefined){eventListeners[eventName]=[]}eventListeners[eventName].push(listener)};that.removeEventListener=function(eventName,listener){var i;if(eventListeners[eventName]){for(i=0;i<eventListeners[eventName].length;i+=1){if(eventListeners[eventName][i]===listener){eventListeners[eventName].splice(i,1)}}}};that.removeAllEventListeners=function(){var key;for(var key in eventListeners){if(eventListeners.hasOwnProperty(key)){delete eventListeners[key]}}};that.dispatchEvent=function(eventName,args){var i;if(eventListeners[eventName]!==undefined){for(i=0;i<eventListeners[eventName].length;i+=1){eventListeners[eventName][i](args)}}};return that};PBS.KIDS.storybook.interactionObject=function(GLOBAL,PBS,element){"use strict";return PBS.KIDS.storybook.makeInteractionObject(GLOBAL,PBS,PBS.KIDS.storybook.view(PBS,element))};PBS.KIDS.storybook.makeInteractionObject=function(GLOBAL,PBS,view){"use strict";var pressed=false,element=view.getElement(),dragStartLoc,press=function(e){var loc={},elementPos=PBS.KIDS.storybook.getElementPosition(element),interaction=e.changedTouches?e.changedTouches[0]:e;loc.x=interaction.clientX-elementPos.x;loc.y=interaction.clientY-elementPos.y;pressed=true;dragStartLoc={x:loc.x,y:loc.y};view.dispatchEvent("PRESS",{x:loc.x,y:loc.y});e.preventDefault()},drag=function(e){var loc={},elementPos=PBS.KIDS.storybook.getElementPosition(element),interaction=e.changedTouches?e.changedTouches[0]:e;loc.x=interaction.clientX-elementPos.x;loc.y=interaction.clientY-elementPos.y;if(pressed){view.dispatchEvent("DRAG",{x:loc.x,y:loc.y,startX:dragStartLoc.x,startY:dragStartLoc.y,distanceX:GLOBAL.Math.abs(loc.x-dragStartLoc.x),distanceY:GLOBAL.Math.abs(loc.y-dragStartLoc.y),distance:PBS.KIDS.storybook.distance({x:loc.x,y:loc.y},{x:dragStartLoc.x,y:dragStartLoc.y})})}},release=function(e){pressed=false;view.dispatchEvent("RELEASE")},cancel=function(e){pressed=false;view.dispatchEvent("CANCEL")};view.cancelInteraction=function(){cancel()};element.addEventListener("mousedown",press);element.addEventListener("mousemove",drag);element.addEventListener("mouseup",release);element.addEventListener("mouseout",cancel);element.addEventListener("touchstart",press);element.addEventListener("touchmove",drag);element.addEventListener("touchend",release);element.addEventListener("touchcancel",cancel);element.setAttribute("role","button");return view};PBS.KIDS.storybook.resourceLoader=function(GLOBAL,PBS){"use strict";var that=PBS.KIDS.storybook.eventDispatcher(),resources={},queue=[],numResourcesLoaded=0,loadStarted=false,onResourceLoaded=function(){numResourcesLoaded+=1;that.dispatchEvent("QUEUE_UPDATE",{progress:numResourcesLoaded,total:queue.length});if(numResourcesLoaded===queue.length){that.dispatchEvent("QUEUE_LOADED")}},onResourceLoadError=function(){PBS.KIDS.storybook.error("Resource load error.")};that.addToQueue=function(url){if(resources[url]===undefined){resources[url]={image:new Image,url:url,loaded:false};queue.push(resources[url])}return resources[url]};that.loadQueue=function(){var key;if(!loadStarted){loadStarted=true;for(key in resources){if(resources.hasOwnProperty(key)){resources[key].image.addEventListener("load",onResourceLoaded)}}for(key in resources){if(resources.hasOwnProperty(key)){resources[key].image.src=resources[key].url}}}};that.getProgress=function(){return numResourcesLoaded};that.getTotal=function(){return queue.length};return that};String.prototype.hairlip=function(o){"use strict";return this.replace(/\{\{([a-zA-Z0-9]*)\}\}/g,function(a,b){return{string:true,number:true}[typeof o[b]]?o[b]:""})};PBS.KIDS.storybook.book=function(GLOBAL,PBS,storybookContainerElement,config){"use strict";var sb=PBS.KIDS.storybook,that=sb.eventDispatcher(),resourceLoader=sb.resourceLoader(GLOBAL,PBS),audioPlayer,paused=false,loadStarted=false,destroyed=false,initialized=false,numPagesLoaded=0,curPageIndex,targetPageIndex,curOrientation,bookConfig=config.book,leftPageIndex,rightPageIndex,pageElementWidth,pageElementHeight,prevPageButtonSprite,nextPageButtonSprite,pageTurnDuration,pageSlideDuration,navigating=false,cover,pages=[],bookMargin,minBookMargin=config.book.margin!==undefined?config.book.margin:2,audioLoadInitiated=false,audioLoadedEnough=false,resourceLoadComplete=false,bookWrapperElement,bookContainerElement,pagesContainerElement,leftPageContainerElement,rightPageContainerElement,navElement,prevPageButtonElement,nextPageButtonElement,pageTurnContainerElement,loadingContainerElement,loadingView,loadEvent,setCSSProperty=function(element,property,value,prefixed){var vendors=["ms","moz","webkit","o"],i;if(prefixed){for(i=0;i<vendors.length;i+=1){element.style["-"+vendors[i]+"-"+property]=value}}element.style[property]=value},trim=function(text){return text==null?"":(text+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},addClass=function(elem,value,remove){var classes,cur,clazz,j,finalValue,i,rnotwhite=/\S+/g;if(typeof value==="string"&&value){classes=(value||"").match(rnotwhite)||[];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;if(remove){while(clazz=classes[j++]){if(remove){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}else{if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}}}finalValue=trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}},removeClass=function(elem,value){addClass(elem,value,true)},loop=function(){if(!destroyed){if(!paused){if(curPageIndex===targetPageIndex){if(curPageIndex===-1){cover.update()}else{if(pages[leftPageIndex]){pages[leftPageIndex].update()}if(pages[rightPageIndex]){pages[rightPageIndex].update()}}}}GLOBAL.requestAnimationFrame(loop);if(!paused){render()}}},render=function(){if(curPageIndex===-1){cover.render()}else{if(pages[leftPageIndex]){pages[leftPageIndex].render()}if(pages[rightPageIndex]){pages[rightPageIndex].render()}}},pageDraggedLeft=function(page){if(page===pages[rightPageIndex]||page===cover){that.nextPage()}else{if(curOrientation==="SINGLE-PAGE"){that.nextPage()}}},pageDraggedRight=function(page){if(page===pages[leftPageIndex]){that.previousPage()}else{if(curOrientation==="SINGLE-PAGE"){that.previousPage()}}},leftPageSoundComplete=function(){audioPlayer.removeEventListener("PLAY_COMPLETE",leftPageSoundComplete);if(pages[rightPageIndex]&&pages[rightPageIndex].pageSound){loud();audioPlayer.play(pages[rightPageIndex].pageSound);audioPlayer.addEventListener("PLAY_COMPLETE",rightPageSoundComplete)}else{silent()}},rightPageSoundComplete=function(){audioPlayer.removeEventListener("PLAY_COMPLETE",rightPageSoundComplete);silent()},hideBrowserUi=function(){GLOBAL.document.body.style.height="200%";GLOBAL.scrollTo(0,1);GLOBAL.document.body.style.height=GLOBAL.innerHeight+"px"},fitWidth=function(containerWidth){if(curOrientation==="SINGLE-PAGE"){if(curPageIndex!==-1){containerWidth*=1.8}}bookMargin=containerWidth*(minBookMargin/100);bookContainerElement.style.width=GLOBAL.parseInt(containerWidth-bookMargin*2,10)+"px";pagesContainerElement.style.width=GLOBAL.parseInt(containerWidth-bookMargin*2,10)+"px";pageElementWidth=rightPageContainerElement.offsetWidth;pageElementHeight=pageElementWidth/bookConfig.pageWidth*bookConfig.pageHeight;bookContainerElement.style.margin=bookMargin+"px";bookContainerElement.style.height=GLOBAL.parseInt(pageElementHeight)+"px";pagesContainerElement.style.height=GLOBAL.parseInt(pageElementHeight)+"px";pageTurnContainerElement.style.width=GLOBAL.parseInt(pageElementWidth,10)+1+"px";pageTurnContainerElement.style.height=GLOBAL.parseInt(pageElementHeight,10)+"px"},fitHeight=function(containerHeight){bookMargin=containerHeight*(minBookMargin/100);pagesContainerElement.style.height=containerHeight-bookMargin*2+"px";bookContainerElement.style.height=containerHeight-bookMargin*2+"px";pageElementHeight=rightPageContainerElement.offsetHeight;pageElementWidth=pagesContainerElement.offsetHeight/bookConfig.pageHeight*bookConfig.pageWidth;if(curPageIndex===-1){pagesContainerElement.style.width=GLOBAL.parseInt(pageElementWidth,10)+"px";bookContainerElement.style.width=GLOBAL.parseInt(pageElementWidth,10)+"px"}else{pagesContainerElement.style.width=GLOBAL.parseInt(pageElementWidth*2,10)+"px";bookContainerElement.style.width=GLOBAL.parseInt(pageElementWidth*2,10)+"px"}pageTurnContainerElement.style.width=GLOBAL.parseInt(pageElementWidth,10)+1+"px";pageTurnContainerElement.style.height=pageElementHeight+"px"},loud=function(){pagesContainerElement.className=pagesContainerElement.className.replace(" loud","");pagesContainerElement.className=pagesContainerElement.className.replace(" silent","");pagesContainerElement.className+=" loud"},silent=function(){pagesContainerElement.className=pagesContainerElement.className.replace(" loud","");pagesContainerElement.className=pagesContainerElement.className.replace(" silent","");pagesContainerElement.className+=" silent"},updateLayout=function(){var orientation;hideBrowserUi();orientation=storybookContainerElement.clientHeight>storybookContainerElement.clientWidth?"SINGLE-PAGE":"TWO-PAGE";if(curOrientation!==orientation){that.dispatchEvent("LAYOUT_CHANGE",orientation);curOrientation=orientation}fitWidth(storybookContainerElement.offsetWidth);if(bookContainerElement.offsetHeight>storybookContainerElement.offsetHeight*(1-minBookMargin/100*2)){fitHeight(storybookContainerElement.offsetHeight)}storybookContainerElement.style.fontSize=pageElementWidth/bookConfig.pageWidth+"px";updatePosition()},updatePosition=function(){var containerWidth=storybookContainerElement.offsetWidth;bookContainerElement.style.marginTop=(storybookContainerElement.offsetHeight-bookContainerElement.offsetHeight)/2+"px";if(curPageIndex===-1){setCSSProperty(bookContainerElement,"transition","","prefixed");bookContainerElement.style.marginLeft=(containerWidth-pagesContainerElement.offsetWidth)/2+"px";that.dispatchEvent("ON_COVER")}else{if(curOrientation==="SINGLE-PAGE"){setCSSProperty(bookContainerElement,"transition","margin-left "+pageSlideDuration/1e3+"s linear","prefixed");if(curPageIndex%2){bookContainerElement.style.marginLeft=-(bookMargin+pageElementWidth*2-containerWidth)+"px"}else{bookContainerElement.style.marginLeft=bookMargin+"px"}}else{bookContainerElement.className="";bookContainerElement.style.marginLeft=(containerWidth-pagesContainerElement.offsetWidth)/2+"px";that.dispatchEvent("ON_INTERNAL")}}},updatePosition2=function(){var containerWidth=storybookContainerElement.offsetWidth;bookContainerElement.style.marginTop=(storybookContainerElement.offsetHeight-bookContainerElement.offsetHeight)/2+"px";if(curPageIndex===-1){bookContainerElement.style["transition"]="";bookContainerElement.style["-webkit-transition"]="";bookContainerElement.style["-moz-transition"]="";bookContainerElement.style["-ms-transition"]="";bookContainerElement.style["-o-transition"]="";bookContainerElement.style.marginLeft=(containerWidth-pagesContainerElement.offsetWidth)/2+"px"}else{if(curOrientation==="SINGLE-PAGE"){bookContainerElement.style["transition"]="margin-left "+pageTurnDuration/1e3+"s linear";bookContainerElement.style["-webkit-transition"]="margin-left "+pageTurnDuration/1e3+"s linear";bookContainerElement.style["-moz-transition"]="margin-left "+pageTurnDuration/1e3+"s linear";bookContainerElement.style["-ms-transition"]="margin-left "+pageTurnDuration/1e3+"s linear";bookContainerElement.style["-o-transition"]="margin-left "+pageTurnDuration/1e3+"s linear";if(targetPageIndex%2){bookContainerElement.style.marginLeft=-(bookMargin+pageElementWidth*2-containerWidth)+"px"}else{bookContainerElement.style.marginLeft=bookMargin+"px"}}else{bookContainerElement.className="";bookContainerElement.style.marginLeft=(containerWidth-pagesContainerElement.offsetWidth)/2+"px"}}},onNavigateComplete=function(){if(targetPageIndex!==curPageIndex){if(targetPageIndex>curPageIndex){pagesContainerElement.style.marginLeft="0";pagesContainerElement.style.width="100%";leftPageContainerElement.style.display="block";rightPageContainerElement.style.width="50%";sb.removeAllChildren(leftPageContainerElement);leftPageContainerElement.appendChild(pages[leftPageIndex].getElement());sb.removeAllChildren(rightPageContainerElement);rightPageContainerElement.appendChild(pages[rightPageIndex].getElement())}else{sb.removeAllChildren(rightPageContainerElement);if(targetPageIndex===-1){pagesContainerElement.style.marginLeft="0";pagesContainerElement.style.width="50%";leftPageContainerElement.style.display="none";rightPageContainerElement.style.width="100%";rightPageContainerElement.appendChild(cover.getElement())}else{rightPageContainerElement.appendChild(pages[rightPageIndex].getElement())}}}sb.removeAllChildren(pageTurnContainerElement);pageTurnContainerElement.style.display="none";curPageIndex=targetPageIndex;updateLayout();if(targetPageIndex===-1){that.dispatchEvent("NAVIGATION_TO_COMPLETE");cover.navigationToComplete();if(cover.pageSound){audioPlayer.play(cover.pageSound)}}else{that.dispatchEvent("NAVIGATION_TO_COMPLETE");pages[leftPageIndex].navigationToComplete();that.dispatchEvent("NAVIGATION_TO_COMPLETE");pages[rightPageIndex].navigationToComplete();if(curOrientation==="SINGLE-PAGE"){if(leftPageIndex===curPageIndex){if(pages[leftPageIndex].pageSound){audioPlayer.play(pages[leftPageIndex].pageSound)}}else{if(pages[rightPageIndex].pageSound){audioPlayer.play(pages[rightPageIndex].pageSound)}}}else{if(pages[leftPageIndex].pageSound){loud();audioPlayer.play(pages[leftPageIndex].pageSound);audioPlayer.addEventListener("PLAY_COMPLETE",leftPageSoundComplete)}else if(pages[rightPageIndex].pageSound){loud();audioPlayer.play(pages[leftPageIndex].pageSound);audioPlayer.addEventListener("PLAY_COMPLETE",rightPageSoundComplete)}}}if(targetPageIndex===-1){if(prevPageButtonElement){prevPageButtonElement.style.display="none"}if(nextPageButtonElement){nextPageButtonElement.style.display="block"}}else{if(curOrientation==="SINGLE-PAGE"){if(prevPageButtonElement){prevPageButtonElement.style.display=targetPageIndex===-1?"none":"block"}if(nextPageButtonElement){nextPageButtonElement.style.display=targetPageIndex===pages.length-1?"none":"block"}}else{if(prevPageButtonElement){prevPageButtonElement.style.display=leftPageIndex===-1?"none":"block"}if(nextPageButtonElement){nextPageButtonElement.style.display=rightPageIndex===pages.length-1?"none":"block"}}}that.dispatchEvent("PAGE_CHANGE");navigating=false},onNavigateMiddle=function(){var pageContainerElement,gradientElement;sb.removeAllChildren(pageTurnContainerElement);if(targetPageIndex>curPageIndex){pageContainerElement=GLOBAL.document.createElement("div");pageContainerElement.className="pbsPageTurnPageContainer";pageTurnContainerElement.appendChild(pageContainerElement);if(curPageIndex===-1){pageTurnContainerElement.style.marginLeft=-pageElementWidth/2+"px"}else{pageTurnContainerElement.style.marginLeft="0"}pageContainerElement.appendChild(pages[leftPageIndex].getElement());gradientElement=GLOBAL.document.createElement("div");gradientElement.className="pbsLeftPageTurnGradient";pageTurnContainerElement.appendChild(gradientElement);pageTurnContainerElement.style.transformOrigin="right top";pageTurnContainerElement.style.webkitTransformOrigin="right top";pageTurnContainerElement.style.mozTransformOrigin="right top";pageTurnContainerElement.style.msTransformOrigin="right top";pageTurnContainerElement.style.oTransformOrigin="right top"}else{pageContainerElement=GLOBAL.document.createElement("div");pageContainerElement.className="pbsPageTurnPageContainer";pageTurnContainerElement.appendChild(pageContainerElement);if(targetPageIndex===-1){pageTurnContainerElement.style.marginLeft=pageElementWidth+"px";pageContainerElement.appendChild(cover.getElement());cover.update();cover.render()}else{pageTurnContainerElement.style.marginLeft=pageElementWidth+"px";pageContainerElement.appendChild(pages[rightPageIndex].getElement())}gradientElement=GLOBAL.document.createElement("div");gradientElement.className="pbsRightPageTurnGradient";pageTurnContainerElement.appendChild(gradientElement);pageTurnContainerElement.style.transformOrigin="left top";pageTurnContainerElement.style.webkitTransformOrigin="left top";pageTurnContainerElement.style.mozTransformOrigin="left top";pageTurnContainerElement.style.msTransformOrigin="left top";pageTurnContainerElement.style.oTransformOrigin="left top"}gradientElement.style.opacity=1;gradientElement.style["transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-webkit-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-moz-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-ms-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-o-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";GLOBAL.setTimeout(function(){gradientElement.style.opacity=0;pageTurnContainerElement.style["transform"]="scale(1, 1)";pageTurnContainerElement.style["-webkit-transform"]="scale(1, 1)";pageTurnContainerElement.style["-moz-transform"]="scale(1, 1)";pageTurnContainerElement.style["-ms-transform"]="scale(1, 1)";pageTurnContainerElement.style["-o-transform"]="scale(1, 1)"},0);GLOBAL.setTimeout(onNavigateComplete,pageTurnDuration/2)},navigateToPageIndex=function(pageIndex,doNotAnimate){var curLeftPageIndex=leftPageIndex,curRightPageIndex=rightPageIndex,pageContainerElement,gradientElement,leftMargin;if(navigating){return}sb.log("Navigate to page "+(pageIndex+1));if(curLeftPageIndex===undefined||curRightPageIndex===undefined||pageTurnDuration===0){doNotAnimate=true}targetPageIndex=pageIndex;if(audioPlayer){audioPlayer.stop()}sb.removeAllChildren(pageTurnContainerElement);if(targetPageIndex%2){leftPageIndex=targetPageIndex-1;rightPageIndex=targetPageIndex}else{leftPageIndex=targetPageIndex;rightPageIndex=targetPageIndex+1}if(prevPageButtonElement){prevPageButtonElement.style.display="none"}if(nextPageButtonElement){nextPageButtonElement.style.display="none"}if(targetPageIndex===curPageIndex){if(curPageIndex===-1){rightPageContainerElement.appendChild(cover.getElement())}else{sb.removeAllChildren(leftPageContainerElement);leftPageContainerElement.appendChild(pages[leftPageIndex].getElement());sb.removeAllChildren(rightPageContainerElement);rightPageContainerElement.appendChild(pages[rightPageIndex].getElement())}}else if(targetPageIndex>curPageIndex){if(!doNotAnimate){sb.removeAllChildren(leftPageContainerElement);if(curPageIndex!==-1){leftPageContainerElement.appendChild(pages[curLeftPageIndex].getElement())}}sb.removeAllChildren(rightPageContainerElement);rightPageContainerElement.appendChild(pages[rightPageIndex].getElement())}else{sb.removeAllChildren(leftPageContainerElement);if(targetPageIndex!==-1){leftPageContainerElement.appendChild(pages[leftPageIndex].getElement())}if(!doNotAnimate){sb.removeAllChildren(rightPageContainerElement);rightPageContainerElement.appendChild(pages[curRightPageIndex].getElement())}}if(pages[leftPageIndex]){that.dispatchEvent("NAVIGATION_TO_BEGIN");pages[leftPageIndex].navigationToBegin()}if(pages[rightPageIndex]){that.dispatchEvent("NAVIGATION_TO_BEGIN");pages[rightPageIndex].navigationToBegin()}if(doNotAnimate){if(targetPageIndex===-1){pagesContainerElement.style.width="50%";leftPageContainerElement.style.display="none";rightPageContainerElement.style.width="100%"}else{leftPageContainerElement.style.display="block";rightPageContainerElement.style.display="block";leftPageContainerElement.style.width="50%";rightPageContainerElement.style.width="50%"}onNavigateComplete()}else{if(targetPageIndex>curPageIndex){if(curOrientation==="TWO-PAGE"||curPageIndex%2){pageContainerElement=GLOBAL.document.createElement("div");pageContainerElement.className="pbsPageTurnPageContainer";pageTurnContainerElement.appendChild(pageContainerElement);if(curPageIndex===-1){pageTurnContainerElement.style.marginLeft=pageElementWidth/2+"px";pagesContainerElement.style.marginLeft=pageElementWidth/2+"px";pagesContainerElement.style.width=pageElementWidth+"px";leftPageContainerElement.style.display="none";rightPageContainerElement.style.width=pageElementWidth+"px";pageContainerElement.appendChild(cover.getElement());sb.removeAllChildren(leftPageContainerElement);leftPageContainerElement.appendChild(pages[leftPageIndex].getElement());sb.removeAllChildren(rightPageContainerElement);rightPageContainerElement.appendChild(pages[rightPageIndex].getElement())}else{pageTurnContainerElement.style.marginLeft=pageElementWidth+"px";pageContainerElement.appendChild(pages[curRightPageIndex].getElement())}gradientElement=GLOBAL.document.createElement("div");gradientElement.className="pbsRightPageTurnGradient";pageTurnContainerElement.appendChild(gradientElement);gradientElement.style.opacity=0;gradientElement.style["transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-webkit-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-moz-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-ms-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-o-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";pageTurnContainerElement.style.transformOrigin="left top";pageTurnContainerElement.style.webkitTransformOrigin="left top";pageTurnContainerElement.style.mozTransformOrigin="left top";pageTurnContainerElement.style.msTransformOrigin="left top";pageTurnContainerElement.style.oTransformOrigin="left top";GLOBAL.setTimeout(function(){pageTurnContainerElement.style["transform"]="scale(0, 1)";pageTurnContainerElement.style["-webkit-transform"]="scale(0, 1)";pageTurnContainerElement.style["-moz-transform"]="scale(0, 1)";pageTurnContainerElement.style["-ms-transform"]="scale(0, 1)";pageTurnContainerElement.style["-o-transform"]="scale(0, 1)";gradientElement.style.opacity=1},0);pageTurnContainerElement.style.display="block";GLOBAL.setTimeout(updatePosition2,500);navigating=true;GLOBAL.setTimeout(onNavigateMiddle,pageTurnDuration/2)}else{onNavigateComplete()}}else{if(curOrientation==="TWO-PAGE"||curPageIndex%2===0){pageContainerElement=GLOBAL.document.createElement("div");pageContainerElement.className="pbsPageTurnPageContainer";pageTurnContainerElement.appendChild(pageContainerElement);pageContainerElement.appendChild(pages[curLeftPageIndex].getElement());pageTurnContainerElement.style.marginLeft=0;if(targetPageIndex===-1){pagesContainerElement.style.marginLeft=pageElementWidth+"px";pagesContainerElement.style.width=pageElementWidth+"px";leftPageContainerElement.style.display="none";rightPageContainerElement.style.width=pageElementWidth+"px"}gradientElement=GLOBAL.document.createElement("div");gradientElement.className="pbsLeftPageTurnGradient";pageTurnContainerElement.appendChild(gradientElement);gradientElement.style.opacity=0;gradientElement.style["transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-webkit-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-moz-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-ms-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";gradientElement.style["-o-transition"]="opacity "+pageTurnDuration/2/1e3+"s linear";pageTurnContainerElement.style.transformOrigin="right top";pageTurnContainerElement.style.webkitTransformOrigin="right top";pageTurnContainerElement.style.mozTransformOrigin="right top";pageTurnContainerElement.style.msTransformOrigin="right top";pageTurnContainerElement.style.oTransformOrigin="right top";GLOBAL.setTimeout(function(){pageTurnContainerElement.style["transform"]="scale(0, 1)";pageTurnContainerElement.style["-webkit-transform"]="scale(0, 1)";pageTurnContainerElement.style["-moz-transform"]="scale(0, 1)";pageTurnContainerElement.style["-ms-transform"]="scale(0, 1)";pageTurnContainerElement.style["-o-transform"]="scale(0, 1)";gradientElement.style.opacity=1},0);pageTurnContainerElement.style.display="block";GLOBAL.setTimeout(updatePosition2,500);navigating=true;GLOBAL.setTimeout(onNavigateMiddle,pageTurnDuration/2)}else{onNavigateComplete()}}}},start=function(){var i;for(i=0;i<pages.length;i+=1){cover.render();pages[i].render()}storybookContainerElement.innerHTML="";storybookContainerElement.appendChild(bookWrapperElement);storybookContainerElement.appendChild(navElement);GLOBAL.onorientationchange=that.onOrientationChange;GLOBAL.addEventListener("resize",updateLayout);updateLayout();curPageIndex=bookConfig.startOnPage!==undefined?bookConfig.startOnPage-1:-1;navigateToPageIndex(curPageIndex,true);updateLayout();storybookContainerElement.addEventListener("touchmove",function(e){e.preventDefault()});if(prevPageButtonSprite){prevPageButtonSprite.update();prevPageButtonSprite.render();prevPageButtonSprite.addEventListener("PRESS",that.previousPage)}if(nextPageButtonSprite){nextPageButtonSprite.update();nextPageButtonSprite.render();nextPageButtonSprite.addEventListener("PRESS",that.nextPage)}that.dispatchEvent("STARTED");loop()},createResources=function(){var i,j,k,key,key2;for(key in bookConfig.pageBackground){if(bookConfig.pageBackground.hasOwnProperty(key)){if(key==="url"){bookConfig.pageBackground.resource=resourceLoader.addToQueue(bookConfig.pageBackground.url)}}}for(key in bookConfig.oddPageBackground){if(bookConfig.oddPageBackground.hasOwnProperty(key)){if(key==="url"){bookConfig.oddPageBackground.resource=resourceLoader.addToQueue(bookConfig.oddPageBackground.url)}}}for(key in bookConfig.evenPageBackground){if(bookConfig.evenPageBackground.hasOwnProperty(key)){if(key==="url"){bookConfig.evenPageBackground.resource=resourceLoader.addToQueue(bookConfig.evenPageBackground.url)}}}for(key in config.cover.background){if(config.cover.background.hasOwnProperty(key)){if(key==="url"){config.cover.background.resource=resourceLoader.addToQueue(config.cover.background.url)}}}for(j=0;j<config.cover.content.length;j+=1){for(key in config.cover.content[j]){if(key==="url"){config.cover.content[j].resource=resourceLoader.addToQueue(config.cover.content[j].url)}else if(key==="content"){for(k=0;k<config.cover.content[j].content.length;k+=1){for(key2 in config.cover.content[j].content[k]){if(key2==="url"){config.cover.content[j].content[k].resource=resourceLoader.addToQueue(config.cover.content[j].content[k].url)}}}}}}for(i=0;i<config.pages.length;i+=1){for(key in config.pages[i].background){if(config.pages[i].background.hasOwnProperty(key)){if(key==="url"){config.pages[i].background.resource=resourceLoader.addToQueue(config.pages[i].background.url)}}}for(j=0;j<config.pages[i].content.length;j+=1){for(key in config.pages[i].content[j]){if(key==="url"){config.pages[i].content[j].resource=resourceLoader.addToQueue(config.pages[i].content[j].url)}else if(key==="content"){for(k=0;k<config.pages[i].content[j].content.length;k+=1){for(key2 in config.pages[i].content[j].content[k]){if(key2==="url"){config.pages[i].content[j].content[k].resource=resourceLoader.addToQueue(config.pages[i].content[j].content[k].url)}}}}}if(config.pages[i].content[j].type.toUpperCase()==="DRAWINGPAD"){if(config.pages[i].content[j].overlayUrl){config.pages[i].content[j].overlayResource=resourceLoader.addToQueue(config.pages[i].content[j].overlayUrl)}if(config.pages[i].content[j].textureUrl){config.pages[i].content[j].textureResource=resourceLoader.addToQueue(config.pages[i].content[j].textureUrl)}for(key in config.pages[i].content[j]){if(key==="colorButtons"){for(k=0;k<config.pages[i].content[j].colorButtons.length;k+=1){for(key2 in config.pages[i].content[j].colorButtons[k]){if(key2==="url"){config.pages[i].content[j].colorButtons[k].resource=resourceLoader.addToQueue(config.pages[i].content[j].colorButtons[k].url)}}}}else if(key==="clearButtons"){for(k=0;k<config.pages[i].content[j].clearButtons.length;k+=1){for(key2 in config.pages[i].content[j].clearButtons[k]){if(key2==="url"){config.pages[i].content[j].clearButtons[k].resource=resourceLoader.addToQueue(config.pages[i].content[j].clearButtons[k].url)}}}}else if(key==="eraserButtons"){for(k=0;k<config.pages[i].content[j].eraserButtons.length;k+=1){for(key2 in config.pages[i].content[j].eraserButtons[k]){if(key2==="url"){config.pages[i].content[j].eraserButtons[k].resource=resourceLoader.addToQueue(config.pages[i].content[j].eraserButtons[k].url)}}}}}}}}},updateLoadMessage=function(e){if(e){loadEvent=e}else{loadEvent={};loadEvent.progress=resourceLoader.getProgress();loadEvent.total=resourceLoader.getTotal()}if(audioPlayer){if(audioLoadInitiated){if(audioLoadedEnough){loadingContainerElement.innerHTML='<p id="loadingText">Loading '+(loadEvent.progress+1)+" of "+loadEvent.total+"</p>"}else{loadingContainerElement.innerHTML='<p id="loadingText">Loading '+loadEvent.progress+" of "+(loadEvent.total+1)+"</p>"}}else{loadingContainerElement.innerHTML='<p id="loadingText">Loading '+loadEvent.progress+" of "+(loadEvent.total+1)+"<br />Press to load sound.</p>"}}else{loadingContainerElement.innerHTML='<p id="loadingText">Loading '+loadEvent.progress+" of "+loadEvent.total+"</p>"}},audioLoaded=function(){if(!audioLoadedEnough){storybookContainerElement.removeEventListener("LOAD_STARTED",audioLoaded);audioLoadedEnough=true;if(resourceLoadComplete){start()}}},resourcesLoaded=function(){resourceLoadComplete=true;that.dispatchEvent("LOADED");if(!audioPlayer||audioLoadedEnough===true){start()}},loadAudio=function(){storybookContainerElement.removeEventListener("PRESS",loadAudio);audioPlayer.addEventListener("LOAD_STARTED",audioLoaded);audioPlayer.load();audioLoadInitiated=true;updateLoadMessage()},init=function(){var i,pageContainerElement,audioFilename;if(!initialized){initialized=true;bookWrapperElement=GLOBAL.document.createElement("div");bookWrapperElement.id="pbsBookWrapper";if(config.background&&config.background.color){bookWrapperElement.style.backgroundColor=config.background.color}if(config.background&&config.background.url){bookWrapperElement.style.backgroundImage="url("+config.background.url+")"}bookContainerElement=GLOBAL.document.createElement("div");bookContainerElement.id="pbsBookContainer";bookContainerElement.setAttribute("role","region");bookContainerElement.setAttribute("aria-live","polite");bookWrapperElement.appendChild(bookContainerElement);
pagesContainerElement=GLOBAL.document.createElement("div");pagesContainerElement.className="pbsPagesContainer";bookContainerElement.appendChild(pagesContainerElement);leftPageContainerElement=GLOBAL.document.createElement("div");leftPageContainerElement.className="pbsPageContainer";leftPageContainerElement.id="pbsLeftPage";leftPageContainerElement.style.width="50%";pagesContainerElement.appendChild(leftPageContainerElement);rightPageContainerElement=GLOBAL.document.createElement("div");rightPageContainerElement.className="pbsPageContainer";rightPageContainerElement.id="pbsRightPage";pagesContainerElement.appendChild(rightPageContainerElement);pageTurnContainerElement=GLOBAL.document.createElement("div");pageTurnContainerElement.className="pbsPageTurnContainer";bookContainerElement.appendChild(pageTurnContainerElement);navElement=GLOBAL.document.createElement("nav");navElement.className="pbsStorybookNav";if(bookConfig.previousPageButton){prevPageButtonElement=GLOBAL.document.createElement("div");prevPageButtonElement.id="pbsPrevPageButton";prevPageButtonElement.className="pbsPageButton";bookConfig.previousPageButton.parentElement=prevPageButtonElement;bookConfig.previousPageButton.resource=resourceLoader.addToQueue(bookConfig.previousPageButton.url);prevPageButtonSprite=sb.sprite(GLOBAL,PBS,bookConfig.previousPageButton);prevPageButtonSprite=sb.makeInteractionObject(GLOBAL,PBS,prevPageButtonSprite);prevPageButtonSprite.getElement().setAttribute("aria-controls","pbsBookContainer");prevPageButtonSprite.getElement().innerHTML="Go to the last page";navElement.appendChild(prevPageButtonElement)}if(bookConfig.nextPageButton){nextPageButtonElement=GLOBAL.document.createElement("div");nextPageButtonElement.id="pbsNextPageButton";nextPageButtonElement.className="pbsPageButton";bookConfig.nextPageButton.parentElement=nextPageButtonElement;bookConfig.nextPageButton.resource=resourceLoader.addToQueue(bookConfig.nextPageButton.url);nextPageButtonSprite=sb.sprite(GLOBAL,PBS,bookConfig.nextPageButton);nextPageButtonSprite=sb.makeInteractionObject(GLOBAL,PBS,nextPageButtonSprite);nextPageButtonSprite.getElement().setAttribute("aria-controls","pbsBookContainer");nextPageButtonSprite.getElement().innerHTML="Go to the next page";navElement.appendChild(nextPageButtonElement)}createResources();pageTurnDuration=bookConfig&&bookConfig.pageTurnDuration!==undefined?bookConfig.pageTurnDuration:1e3;pageSlideDuration=bookConfig&&bookConfig.pageSlideDuration!==undefined?bookConfig.pageSlideDuration:250;pageTurnContainerElement.style["transition"]="transform "+pageTurnDuration/2/1e3+"s linear";pageTurnContainerElement.style["-webkit-transition"]="-webkit-transform "+pageTurnDuration/2/1e3+"s linear";pageTurnContainerElement.style["-moz-transition"]="-moz-transform "+pageTurnDuration/2/1e3+"s linear";pageTurnContainerElement.style["-ms-transition"]="-ms-transform "+pageTurnDuration/2/1e3+"s linear";pageTurnContainerElement.style["-o-transition"]="-o-transform "+pageTurnDuration/2/1e3+"s linear";if(config.audio&&config.audio&&config.audio.name&&config.audio.enabled!==false){audioPlayer=sb.audioPlayer(GLOBAL,PBS,config.audio.path+config.audio.name)}cover=sb.page(GLOBAL,PBS,config.cover,0,{bookConfig:bookConfig,audioPlayer:audioPlayer});cover.addEventListener("DRAG_LEFT",pageDraggedLeft);cover.addEventListener("DRAG_RIGHT",pageDraggedRight);for(i=0;i<config.pages.length;i+=1){pages[i]=sb.page(GLOBAL,PBS,config.pages[i],i+1,{bookConfig:bookConfig,audioPlayer:audioPlayer});pages[i].update();pages[i].render()}if(config.pages.length%2){pages[config.pages.length]=sb.page(GLOBAL,PBS,{},config.pages.length+1,{bookConfig:bookConfig,audioPlayer:audioPlayer})}for(i=0;i<pages.length;i+=1){pages[i].addEventListener("DRAG_LEFT",pageDraggedLeft);pages[i].addEventListener("DRAG_RIGHT",pageDraggedRight)}updateLayout()}else{sb.error("Cannot initialize storybook more than once.")}};that.pause=function(){if(!paused){paused=true}};that.unpause=function(){if(paused){paused=false}};that.onOrientationChange=function(){updateLayout()};that.getSprite=function(at,ar){return pages[at].getSprite(ar)};that.getDrawingPad=function(at,ar){return pages[at].getDrawingPad(ar)};that.destroy=function(){var i;if(!destroyed){destroyed=true;storybookContainerElement.innerHTML="";for(i=0;i<pages.length;i+=1){pages[i].destroy()}cover.destroy();that=null}};that.nextPage=function(){var targetPageIndex;if(curOrientation==="SINGLE-PAGE"){targetPageIndex=curPageIndex+1}else{if(curPageIndex%2){targetPageIndex=curPageIndex+1}else{targetPageIndex=curPageIndex+2}}if(targetPageIndex<pages.length){navigateToPageIndex(targetPageIndex)}};that.previousPage=function(){var targetPageIndex;if(curOrientation==="SINGLE-PAGE"){targetPageIndex=curPageIndex-1}else{if(curPageIndex%2){targetPageIndex=curPageIndex-2}else{targetPageIndex=curPageIndex-1}}if(targetPageIndex>=-1){navigateToPageIndex(targetPageIndex)}if(targetPageIndex===-1){that.dispatchEvent("TRANSITION_TO_COVER")}};that.gotoPage=function(pageIndex){if(curPageIndex-1<-1||curPageIndex+1>pages.length){return}navigateToPageIndex(pageIndex)};that.load=function(){if(!loadStarted){loadStarted=true;storybookContainerElement.innerHTML="";loadingContainerElement=GLOBAL.document.createElement("section");loadingContainerElement.className="loadingContainer";storybookContainerElement.appendChild(loadingContainerElement);if(audioPlayer){loadingView=sb.interactionObject(GLOBAL,PBS,loadingContainerElement);loadingView.addEventListener("PRESS",loadAudio)}resourceLoader.addEventListener("QUEUE_UPDATE",updateLoadMessage);resourceLoader.addEventListener("QUEUE_LOADED",resourcesLoaded);resourceLoader.loadQueue()}};(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;x+=1){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}})();init();return that};PBS.KIDS.storybook.page=function(GLOBAL,PBS,config,pageNum,options){"use strict";var sb=PBS.KIDS.storybook,that=sb.eventDispatcher(),width=options.bookConfig.pageWidth||768,height=options.bookConfig.pageHeight||1024,audioPlayer=options.audioPlayer,backgroundSprite,ctx,element,textAreaArray=[],spriteArray=[],cyclerArray=[],drawingPadArray=[],contentArray=[],dirty=true,pageView,resourceLoaded=function(){numResourcesLoaded+=1;if(numResourcesLoaded===totalResources&&!loaded){loaded=true;that.dispatchEvent("LOAD_COMPLETE")}};that.pageSound;that.init=function(){var spec,i,curTextArea,curSprite,curCycler,curDrawingPad,pageSoundPersistence;if(config===undefined){sb.error("Configuration missing for page "+pageNum);return}if(pageNum===undefined){sb.error("Missing page number parameter");return}element=GLOBAL.document.createElement("section");element.id="pbsPage"+pageNum;element.className="pbsPage";pageView=sb.interactionObject(GLOBAL,PBS,element);pageView.addEventListener("DRAG",function(e){if(e.distanceX>width/20){pageView.cancelInteraction();if(e.x>e.startX){that.dispatchEvent("DRAG_RIGHT",that)}else{that.dispatchEvent("DRAG_LEFT",that)}}});if(config.background===undefined){config.background={}}config.background.parentElement=element;config.background.className="pbsPageCanvas";if(config.background.resource||config.background.color){}else if(options.bookConfig.oddPageBackground&&pageNum%2&&options.bookConfig.oddPageBackground.resource){config.background.resource=options.bookConfig.oddPageBackground.resource}else if(options.bookConfig.oddPageBackground&&pageNum%2&&options.bookConfig.oddPageBackground.color){config.background.color=options.bookConfig.oddPageBackground.color}else if(options.bookConfig.evenPageBackground&&pageNum%2===0&&options.bookConfig.evenPageBackground.resource){config.background.resource=options.bookConfig.evenPageBackground.resource}else if(options.bookConfig.evenPageBackground&&pageNum%2===0&&options.bookConfig.evenPageBackground.color){config.background.color=options.bookConfig.evenPageBackground.color}else if(options.bookConfig.pageBackground&&options.bookConfig.pageBackground.resource){config.background.resource=options.bookConfig.pageBackground.resource}else if(options.bookConfig.pageBackground&&options.bookConfig.pageBackground.color){config.background.color=options.bookConfig.pageBackground.color}backgroundSprite=sb.sprite(GLOBAL,PBS,config.background);backgroundSprite.addEventListener("LOAD_COMPLETE",resourceLoaded);backgroundSprite=sb.makeInteractionObject(GLOBAL,PBS,backgroundSprite);pageSoundPersistence=config&&config.sound&&config.sound.persist!==undefined?config.sound.persist:true;if(audioPlayer&&config&&config.sound){that.pageSound=sb.sound(config.sound.startTime,config.sound.endTime,{loop:config.sound.loop,persist:pageSoundPersistence})}if(config&&config.content){for(i=0;i<config.content.length;i+=1){switch(config.content[i].type){case"TextArea":config.content[i].parentElement=element;config.content[i].parentWidth=width;config.content[i].parentHeight=height;config.content[i].className="pbsPage"+pageNum+"TextArea"+(textAreaArray.length+1);curTextArea=sb.textArea(GLOBAL,PBS,config.content[i]);if(config.content[i].sound){curTextArea=sb.makeInteractionObject(GLOBAL,PBS,curTextArea);curTextArea=sb.makeAudible(GLOBAL,PBS,audioPlayer,curTextArea,config.content[i].sound)}textAreaArray.push(curTextArea);contentArray.push(curTextArea);break;case"Sprite":config.content[i].parentElement=element;config.content[i].parentWidth=width;config.content[i].parentHeight=height;config.content[i].className="pbsPage"+pageNum+"Sprite"+(spriteArray.length+1);curSprite=sb.sprite(GLOBAL,PBS,config.content[i]);curSprite=sb.makeInteractionObject(GLOBAL,PBS,curSprite);if(config.content[i].sound){curSprite=sb.makeAudible(GLOBAL,PBS,audioPlayer,curSprite,config.content[i].sound)}spriteArray.push(curSprite);contentArray.push(curSprite);if(config.content[i].playAfterDelay>0){curSprite.playAfterDelay=config.content[i].playAfterDelay}break;case"Cycler":config.content[i].parentElement=element;config.content[i].parentWidth=width;config.content[i].parentHeight=height;config.content[i].className="pbsPage"+pageNum+"Cycler"+(cyclerArray.length+1);curCycler=sb.cycler(GLOBAL,PBS,config.content[i]);if(config.content[i].sound){curCycler=sb.makeAudible(GLOBAL,PBS,audioPlayer,curCycler,config.content[i].sound)}contentArray.push(curCycler);cyclerArray.push(curCycler);if(config.content[i].playAfterDelay>0){curCycler.playAfterDelay=config.content[i].playAfterDelay}break;case"DrawingPad":config.content[i].parentElement=element;config.content[i].parentWidth=width;config.content[i].parentHeight=height;config.content[i].className="pbsPage"+pageNum+"DrawingPad"+(cyclerArray.length+1);curDrawingPad=sb.drawingPad(GLOBAL,PBS,config.content[i]);curDrawingPad=sb.makeInteractionObject(GLOBAL,PBS,curDrawingPad);if(config.content[i].sound){curDrawingPad=sb.makeAudible(GLOBAL,PBS,audioPlayer,curDrawingPad,config.content[i].sound)}drawingPadArray.push(curDrawingPad);contentArray.push(curDrawingPad);break;default:sb.error("Object Type Unknown: "+config.content[i].type);break}}}};that.getElement=function(){return element};that.navigationToBegin=function(){var i;for(i=0;i<cyclerArray.length;i+=1){cyclerArray[i].reset()}};that.navigationToComplete=function(){var i;if(backgroundSprite){backgroundSprite.play()}for(i=0;i<spriteArray.length;i+=1){if(spriteArray[i].autoStart===true){spriteArray[i].play()}else{spriteArray[i].reset()}if(spriteArray[i].playAfterDelay>0){GLOBAL.setTimeout(spriteArray[i].play,GLOBAL.parseInt(spriteArray[i].playAfterDelay,10)*1e3)}}for(i=0;i<cyclerArray.length;i+=1){if(cyclerArray[i].autoStart===true){cyclerArray[i].play()}else{cyclerArray[i].reset()}if(cyclerArray[i].playAfterDelay>0){GLOBAL.setTimeout(cyclerArray[i].play,GLOBAL.parseInt(cyclerArray[i].playAfterDelay,10)*1e3)}}};that.destroy=function(){var i;if(backgroundSprite){backgroundSprite.destroy()}for(i=0;i<contentArray.length;i+=1){contentArray[i].destroy()}that=null};that.update=function(){var i;if(backgroundSprite){backgroundSprite.update()}for(i=0;i<contentArray.length;i+=1){contentArray[i].update()}};that.render=function(){var i;if(backgroundSprite){backgroundSprite.render()}for(i=0;i<contentArray.length;i+=1){contentArray[i].render()}};that.getSprite=function(v){return spriteArray[v]};that.getDrawingPad=function(v){return drawingPadArray[v]};that.quiet=function(){element.className=element.className.replace(" loud","");element.className=element.className.replace(" quiet","");element.className+=" quiet"};that.loud=function(){element.className=element.className.replace(" loud","");element.className=element.className.replace(" quiet","");element.className+=" loud"};that.init();return that};PBS.KIDS.storybook.textArea=function(GLOBAL,PBS,options){"use strict";var that,element,initialized=false,parentElement=options&&options.parentElement,paragraphContent=[],paragraphElements=[],dirty=true,textArr,convertTag=function(text,htmlTag,newTagName,allowAttr){var regExp,regExpStr,replaceStr;regExpStr="<"+htmlTag;if(allowAttr){regExpStr+="(.*?)"}regExpStr+=">(.*?)</"+htmlTag+">";regExp=new RegExp(regExpStr,"gi");if(allowAttr){replaceStr="["+newTagName+"$1]$2[/"+newTagName+"]"}else{replaceStr="["+newTagName+"]$1[/"+newTagName+"]"}return text.replace(regExp,replaceStr)},removeHtmlTags=function(text){var tmpElement;tmpElement=GLOBAL.document.createElement("div");tmpElement.innerHTML=text;return tmpElement.textContent||tmpElement.innerText||""},init=function(){var i;if(!initialized){initialized=true;that.initView();element.className="pbsTextArea";if(options.className){element.className+=" "+options.className}element.style.textAlign=options.align!==undefined?options.align:"center";element.style.fontFamily=options.font!==undefined?options.font:"";element.style.fontSize=options.size!==undefined?options.size+"em":"1em";element.style.lineHeight="120%";if(options.color!==undefined){element.style.color=options.color}for(i=0;i<textArr.length;i+=1){paragraphContent[i]=textArr[i];if(options.cleanTags!=="false"){paragraphContent[i]=convertTag(paragraphContent[i],"b","bold");paragraphContent[i]=convertTag(paragraphContent[i],"i","italic");paragraphContent[i]=convertTag(paragraphContent[i],"em","emphasis");paragraphContent[i]=convertTag(paragraphContent[i],"color","color",true);paragraphContent[i]=convertTag(paragraphContent[i],"size","size",true);paragraphContent[i]=convertTag(paragraphContent[i],"font","font",true);paragraphContent[i]=removeHtmlTags(paragraphContent[i])}paragraphContent[i]=paragraphContent[i].replace(/\[bold\](.*?)\[\/bold\]/gi,"<b>$1</b>");paragraphContent[i]=paragraphContent[i].replace(/\[italic\](.*?)\[\/italic\]/gi,"<i>$1</i>");paragraphContent[i]=paragraphContent[i].replace(/\[emphasis\](.*?)\[\/emphasis\]/gi,"<em>$1</em>");paragraphContent[i]=paragraphContent[i].replace(/\[color=(.*?)\](.*)\[\/color\]/gi,'<span style="color:$1">$2</span>');paragraphContent[i]=paragraphContent[i].replace(/\[size=(.*?)\](.*?)\[\/size\]/gi,'<span style="font-size:$1em">$2</span>');paragraphContent[i]=paragraphContent[i].replace(/\[font=(.*?)\](.*?)\[\/font\]/gi,'<span style="font-family:$1">$2</span>');if(textArr.length===1){element.innerHTML=paragraphContent[i]}else{paragraphElements[i]=GLOBAL.document.createElement("p");if(that.paragraphSpacing!==null){paragraphElements[i].style.marginBottom=that.paragraphSpacing.toString().toUpperCase().indexOf("PX")!==-1?that.paragraphSpacing:that.paragraphSpacing+"%"}element.appendChild(paragraphElements[i]);paragraphElements[i].innerHTML=paragraphContent[i]}}that.addEventListener("PRESS",that.press)}};if(typeof options.text==="string"){textArr=[options.text]}else{textArr=options.text}element=textArr.length===1?GLOBAL.document.createElement("p"):GLOBAL.document.createElement("div");that=PBS.KIDS.storybook.view(PBS,element);if(parentElement){parentElement.appendChild(element)}that.x=options&&options.x!==undefined?options.x:0;that.y=options&&options.y!==undefined?options.y:0;that.width=options&&options.width!==undefined?options.width:100;that.horizontalAlign=options&&options.horizontalAlign!==undefined?options.horizontalAlign.toUpperCase():"LEFT";that.verticalAlign=options&&options.verticalAlign!==undefined?options.verticalAlign.toUpperCase():"TOP";that.parentWidth=options.parentWidth;that.parentHeight=options.parentHeight;that.paragraphSpacing=options.paragraphSpacing!==undefined?options.paragraphSpacing:null;that.update=function(){};that.render=function(){if(that.dirty){that.dirty=false}};that.press=function(e){console.log("PRESS")};init();return that};PBS.KIDS.storybook.view=function(PBS,element){"use strict";var that=PBS.KIDS.storybook.eventDispatcher(),sb=PBS.KIDS.storybook,element;that.parentWidth;that.parentHeight;that.x;that.y;that.width;that.height;that.horizontalAlign;that.verticalAlign;that.dirty=false;that.getElement=function(){return element};that.initView=function(){if(that.horizontalAlign==="RIGHT"){if(sb.isInPixelUnits(that.x)){if(that.parentWidth){element.style.right=sb.getNumberFromString(that.x)/that.parentWidth*100+"%"}else{element.style.right=that.x}}else{element.style.right=sb.getNumberFromString(that.x)+"%"}}else{if(sb.isInPixelUnits(that.x)){if(that.parentWidth){element.style.left=sb.getNumberFromString(that.x)/that.parentWidth*100+"%"}else{element.style.left=that.x}}else{element.style.left=sb.getNumberFromString(that.x)+"%"}}if(that.verticalAlign==="BOTTOM"){if(sb.isInPixelUnits(that.y)){if(that.parentHeight){element.style.bottom=sb.getNumberFromString(that.y)/that.parentHeight*100+"%"}else{element.style.bottom=that.y}}else{element.style.bottom=sb.getNumberFromString(that.y)+"%"}}else{if(sb.isInPixelUnits(that.y)){if(that.parentHeight){element.style.top=sb.getNumberFromString(that.y)/that.parentHeight*100+"%"}else{element.style.top=that.y}}else{element.style.top=sb.getNumberFromString(that.y)+"%"}}if(that.width){if(sb.isInPixelUnits(that.width)){if(that.parentWidth){element.style.width=sb.getNumberFromString(that.width)/that.parentWidth*100+"%"}else{element.style.width=that.width}}else{element.style.width=sb.getNumberFromString(that.width)+"%"}}if(that.height){if(sb.isInPixelUnits(that.height)){if(that.parentHeight){element.style.height=sb.getNumberFromString(that.height)/that.parentHeight*100+"%"}else{element.style.height=that.height}}else{element.style.height=sb.getNumberFromString(that.height)+"%"}}};that.destroy=function(){element=null;that.removeAllEventListeners();that=null};return that};PBS.KIDS.storybook.sprite=function(GLOBAL,PBS,options){"use strict";var that,element,resource=options&&options.resource!==undefined?options.resource:undefined,ctx,destroyed=false,initialized=false,spec={},previousFrame=0,curFrame=0,updateIndex=0,frameWidth,frameHeight,frameDelay=options.frameDelay||1,loop=options.loop,parentElement=options&&options.parentElement,paused=false,parentWidthRatio=1,parentHeightRatio=1,backgroundColor=options.color,numFrames=options.numFrames,init=function(){if(!initialized){initialized=true;that.initView();if(resource&&resource.image){that.width=resource.image.width;that.height=resource.image.height}else{that.width=100;that.height=100}frameWidth=numFrames?that.width/numFrames:that.width;frameHeight=that.height;element.width=frameWidth;element.height=frameHeight;if(options.width){if(options.width.toString().indexOf("px")!==-1){element.style.width=options.width}else{element.style.width=options.width+"%"}}else if(that.parentWidth){parentWidthRatio=element.width/that.parentWidth;element.style.width=parentWidthRatio*100+"%"}if(options.height){if(options.height.toString().indexOf("px")!==-1){element.style.height=options.height}else{element.style.height=options.height+"%"}}else if(that.parentHeight){parentHeightRatio=element.height/that.parentHeight;element.style.height=parentHeightRatio*100+"%"}that.addEventListener("PRESS",that.press);if(that.autoStart===false){paused=true}that.dirty=true}},resourcesReady=function(){init()},applyEasing=function(curTick,totalTicks,totalNumFrames){var currentFrame;if(options.easing&&options.easing.toUpperCase()==="EASEIN"){currentFrame=totalNumFrames*(1-GLOBAL.Math.cos(curTick/totalTicks*GLOBAL.Math.PI/2))}else if(options.easing&&options.easing.toUpperCase()==="EASEOUT"){currentFrame=totalNumFrames*GLOBAL.Math.sin(curTick/totalTicks*GLOBAL.Math.PI/2)}else{currentFrame=totalNumFrames*curTick/totalTicks}return GLOBAL.Math.floor(currentFrame)};spec.width=99+"px";spec.height=99+"px";spec.className="pbsCanvas pbsSprite";if(options&&options.className){spec.className+=" "+options.className}ctx=PBS.KIDS.storybook.createCanvas(parentElement,spec);that=PBS.KIDS.storybook.view(PBS,ctx.canvas);element=that.getElement();that.x=options&&options.x!==undefined?options.x:0;that.y=options&&options.y!==undefined?options.y:0;that.width=options&&options.width!==undefined?options.width:0;that.height=options&&options.height!==undefined?options.height:0;that.parentWidth=options.parentWidth;that.parentHeight=options.parentHeight;that.horizontalAlign=options&&options.horizontalAlign!==undefined?options.horizontalAlign.toUpperCase():"LEFT",that.verticalAlign=options&&options.verticalAlign!==undefined?options.verticalAlign.toUpperCase():"TOP",that.visible=true;that.alpha;that.destroyed=false;that.url=options&&options.url;that.autoStart=options&&options.autoStart!==undefined?options.autoStart:true;that.autoReset=options&&options.autoReset!==undefined?options.autoReset:false;that.update=function(){if(numFrames&&!paused){if(updateIndex+1>=numFrames*frameDelay){if(loop){curFrame=0;updateIndex=0}else if(that.autoReset){curFrame=0;updateIndex=0;that.stop()}}else{updateIndex+=1;curFrame=applyEasing(updateIndex,numFrames*frameDelay,numFrames)}if(previousFrame!==curFrame){that.dirty=true;previousFrame=curFrame}}};that.render=function(){var curAlpha,frameXPos;if(initialized){if(that.dirty){if(that.visible){curAlpha=ctx.globalAlpha;ctx.globalAlpha=that.alpha;if(backgroundColor){ctx.fillStyle=backgroundColor;ctx.fillRect(0,0,frameWidth,frameHeight)}if(resource&&resource.image){if(numFrames){ctx.canvas.width=ctx.canvas.width;ctx.drawImage(resource.image,GLOBAL.Math.floor(curFrame*frameWidth),0,frameWidth,frameHeight,0,0,frameWidth,frameHeight)}else{ctx.drawImage(resource.image,0,0,frameWidth,frameHeight)}ctx.globalAlpha=curAlpha}}else{ctx.clearRect(0,0,frameWidth,frameHeight)}that.dirty=false}}};that.getElement=function(){return element};that.getCurFrame=function(){return curFrame};that.setCurFrame=function(B){curFrame=B;that.dirty=true;return that};that.play=function(){that.reset();paused=false};that.isAnimation=function(){return numFrames>1};that.resume=function(){paused=false;that.dirty=true};that.stop=function(){paused=true};that.reset=function(){if(curFrame!==0){curFrame=0;updateIndex=0;that.dirty=true;that.stop()}};that.press=function(){if(options.playOnPress){that.play()}else if(options.stopOnPress){that.stop()}else if(options.toggleOnPress){if(paused){that.resume()}else{that.stop()}}};if(resource&&resource.image){resource.image.addEventListener("load",resourcesReady)}else{resourcesReady()}return that};PBS.KIDS.storybook.cycler=function(GLOBAL,PBS,options){"use strict";var that=PBS.KIDS.storybook.eventDispatcher(),initialized=false,itemArray=[],started=false,activeIndex=0,init=function(){var i,curItem,config;if(!initialized){initialized=true;if(options&&options.content){for(i=0;i<options.content.length;i+=1){config=options.content[i];config.parentElement=options.parentElement;config.parentWidth=options.parentWidth;config.parentHeight=options.parentHeight;if(options.className){config.className=options.className+"Sprite"+(i+1)}curItem=PBS.KIDS.storybook.sprite(GLOBAL,PBS,config);curItem=PBS.KIDS.storybook.makeInteractionObject(GLOBAL,PBS,curItem);curItem.addEventListener("PRESS",function(e){that.dispatchEvent("PRESS",{x:e.x,y:e.y});if(started||!itemArray[0].isAnimation()||that.autoStart){that.cycle()}updateAnimation();updateVisibility();started=true});itemArray.push(curItem)}}else{PBS.KIDS.storybook.error("Cycler missing content array.")}}},updateVisibility=function(){var i;for(i=0;i<itemArray.length;i+=1){itemArray[i].visible=i===activeIndex;itemArray[i].dirty=true;itemArray[i].render()}},updateAnimation=function(){var i;for(i=0;i<itemArray.length;i+=1){if(i===activeIndex){itemArray[i].play()}else{itemArray[i].reset()}}};that.x=options&&options.x!==undefined?options.x:0;that.y=options&&options.y!==undefined?options.y:0;that.width=options&&options.width!==undefined?options.width:0;that.height=options&&options.height!==undefined?options.height:0;that.autoStart=options&&options.autoStart!==undefined?options.autoStart:true;that.autoReset=options&&options.autoReset!==undefined?options.autoReset:false;that.cycle=function(){var i;if(activeIndex<itemArray.length-1){activeIndex+=1}else{activeIndex=0}updateAnimation();updateVisibility()};that.play=function(){itemArray[activeIndex].play()};that.resume=function(){itemArray[activeIndex].resume()};that.stop=function(){itemArray[activeIndex].stop()};that.reset=function(){started=false;activeIndex=0;itemArray[activeIndex].reset();updateVisibility()};that.update=function(){itemArray[activeIndex].update()};that.render=function(){itemArray[activeIndex].render()};that.destroy=function(){var i;for(i=0;i<itemArray.length;i+=1){itemArray[i].destroy()}itemArray=null;that=null};init();return that};PBS.KIDS.storybook.drawingPad=function(GLOBAL,PBS,options){"use strict";var that,sb=PBS.KIDS.storybook,element,initialized=false,parentElement=options&&options.parentElement,pad,colorButtons=[],clearButtons=[],eraserButtons=[],resourceLoaded=function(){that.dirty=true},changeColor=function(paintColor){pad.setTool("MARKER");pad.setColor(paintColor)},clearPad=function(){pad.clear()},setEraserTool=function(){pad.setTool("ERASER")},init=function(){var i,width,height,key,key2;if(!initialized){initialized=true;that.initView();element.className="pbsDrawingPad";if(options.className){element.className+=" "+options.className}if(sb.isInPixelUnits(that.width)){width=sb.getNumberFromString(that.width)}else if(sb.isInPercentageUnits(that.width)){width=sb.getNumberFromString(that.width)*that.parentWidth/100}else{width=that.width*that.parentWidth/100}if(sb.isInPixelUnits(that.height)){height=sb.getNumberFromString(that.height)}else if(sb.isInPercentageUnits(that.height)){height=sb.getNumberFromString(that.height)*that.parentHeight/100}else{height=that.height*that.parentHeight/100}pad=WM.drawingCanvas(element,{width:width,height:height,defaultColor:options.defaultColor,radius:options.radius,overlayUrl:options.overlayUrl,textureUrl:options.textureUrl});for(key in options){if(key==="colorButtons"){for(i=0;i<options.colorButtons.length;i+=1){for(key2 in options.colorButtons[i]){if(key2==="url"){if(i===0){changeColor(options.colorButtons[i].paintColor)}options.colorButtons[i].parentElement=parentElement;options.colorButtons[i].parentWidth=that.parentWidth;options.colorButtons[i].parentHeight=that.parentHeight;if(options.className){options.colorButtons[i].className=options.className+"ColorButton"+(i+1)}options.colorButtons[i].resource.image.addEventListener("load",resourceLoaded);colorButtons.push(sb.sprite(GLOBAL,PBS,options.colorButtons[i]));colorButtons[colorButtons.length-1]=sb.makeInteractionObject(GLOBAL,PBS,colorButtons[colorButtons.length-1]);colorButtons[colorButtons.length-1].addEventListener("PRESS",function(color){return function(){changeColor(color)}}(options.colorButtons[i].paintColor))}}}}else if(key==="clearButtons"){for(i=0;i<options.clearButtons.length;i+=1){for(key2 in options.clearButtons[i]){if(key2==="url"){options.clearButtons[i].parentElement=parentElement;options.clearButtons[i].parentWidth=that.parentWidth;options.clearButtons[i].parentHeight=that.parentHeight;if(options.className){options.clearButtons[i].className=options.className+"ClearButton"+(i+1)}options.clearButtons[i].resource.image.addEventListener("load",resourceLoaded);clearButtons.push(sb.sprite(GLOBAL,PBS,options.clearButtons[i]));clearButtons[clearButtons.length-1]=sb.makeInteractionObject(GLOBAL,PBS,clearButtons[clearButtons.length-1]);clearButtons[clearButtons.length-1].addEventListener("PRESS",clearPad)}}}}else if(key==="eraserButtons"){for(i=0;i<options.eraserButtons.length;i+=1){for(key2 in options.eraserButtons[i]){if(key2==="url"){options.eraserButtons[i].parentElement=parentElement;options.eraserButtons[i].parentWidth=that.parentWidth;options.eraserButtons[i].parentHeight=that.parentHeight;if(options.className){options.eraserButtons[i].className=options.className+"EraserButton"+(i+1)}options.eraserButtons[i].resource.image.addEventListener("load",resourceLoaded);eraserButtons.push(sb.sprite(GLOBAL,PBS,options.eraserButtons[i]));eraserButtons[eraserButtons.length-1]=sb.makeInteractionObject(GLOBAL,PBS,eraserButtons[eraserButtons.length-1]);eraserButtons[eraserButtons.length-1].addEventListener("PRESS",setEraserTool)}}}}}}};element=GLOBAL.document.createElement("div");that=PBS.KIDS.storybook.view(PBS,element);if(parentElement){parentElement.appendChild(element)}that.x=options&&options.x!==undefined?options.x:0;that.y=options&&options.y!==undefined?options.y:0;that.width=options&&options.width!==undefined?options.width:100-that.x+"%";that.height=options&&options.height!==undefined?options.height:100-that.y+"%";that.dirty=true;that.parentWidth=options&&options.parentWidth!==undefined?options.parentWidth:100;that.parentHeight=options&&options.parentHeight!==undefined?options.parentHeight:100;that.update=function(){};that.clearPad=function(){clearPad()};that.render=function(){var i;if(that.dirty){that.dirty=false;for(i=0;i<colorButtons.length;i+=1){colorButtons[i].render()}for(i=0;i<eraserButtons.length;i+=1){eraserButtons[i].render()}for(i=0;i<clearButtons.length;i+=1){clearButtons[i].render()}}};init();return that};PBS.KIDS.storybook.audioPlayer=function(GLOBAL,PBS,src,options){"use strict";var that=PBS.KIDS.storybook.eventDispatcher(),initialized=false,loadStarted=false,loadComplete=false,playable=false,loadPercentage=0,audioElement,currentSound=null,loadInterval,completeInterval,onPlay=function(){},onPause=function(){},onCanPlay=function(){if(!playable){playable=true;that.dispatchEvent("LOAD_STARTED")}},onCanPlayThrough=function(){if(!playable){playable=true;that.dispatchEvent("LOAD_STARTED")}},onLoadedData=function(){if(!playable){playable=true;that.dispatchEvent("LOAD_STARTED")}},onLoadedMetadata=function(){},onProgress=function(){},onEnded=function(){},onStalled=function(){},onError=function(e){PBS.KIDS.storybook.debug("audioPlayer.onError: "+e.message)},init=function(){if(!initialized){initialized=true;audioElement=GLOBAL.document.createElement("audio");audioElement.addEventListener("pause",onPause);audioElement.addEventListener("play",onPlay);audioElement.addEventListener("canplay",onCanPlay);audioElement.addEventListener("canplaythrough",onCanPlayThrough);audioElement.addEventListener("loadeddata",onLoadedData);audioElement.addEventListener("loadedmetadata",onLoadedMetadata);audioElement.addEventListener("progress",onProgress);audioElement.addEventListener("ended",onEnded);audioElement.addEventListener("stalled",onStalled);audioElement.addEventListener("error",onError);if(audioElement.canPlayType("audio/mpeg")){src+=".mp3"}else if(audioElement.canPlayType("audio/ogg")){src+=".ogg"}else{return false}return true}},load=function(){loadInterval=GLOBAL.setInterval(function(){var curLoadTime,curLoadPercentage;if(!audioElement.buffered.length){return}curLoadTime=audioElement.buffered.end(audioElement.buffered.length-1);curLoadPercentage=curLoadTime/audioElement.duration*100;
if(curLoadTime&&!isNaN(curLoadPercentage)&&loadPercentage!==curLoadPercentage){loadPercentage=curLoadPercentage;that.dispatchEvent("LOAD_PERCENTAGE_CHANGE")}if(GLOBAL.Math.abs(curLoadTime-audioElement.duration)<.1){GLOBAL.clearInterval(loadInterval);that.dispatchEvent("LOAD_COMPLETE")}},1e3);audioElement.src=src;audioElement.play();audioElement.pause()},endSound=function(){GLOBAL.clearInterval(completeInterval);completeInterval=null;currentSound=null;audioElement.pause()},checkIfComplete=function(){if(!currentSound){GLOBAL.clearInterval(completeInterval);return}if(audioElement.currentTime>=currentSound.endTime){if(currentSound.loop===true){PBS.KIDS.storybook.log("Loop Sound");audioElement.currentTime=currentSound.startTime}else{endSound()}that.dispatchEvent("PLAY_COMPLETE")}};that.autoStart=options&&options.autoStart!==undefined?options.autoStart:true;that.autoReset=options&&options.autoReset!==undefined?options.autoReset:false;that.play=function(soundObj){if(!soundObj){PBS.KIDS.storybook.warning("Trying to play invalid sound.");return}if(soundObj.startTime===undefined||soundObj.startTime<0){PBS.KIDS.storybook.warning("Trying to play sound with invalid sound property. Start time invalid.");return}if(soundObj.endTime===undefined||soundObj.endTime<0){PBS.KIDS.storybook.warning("Trying to play sound with invalid sound property. End time invalid.");return}if(soundObj.startTime>=soundObj.endTime){PBS.KIDS.storybook.warning("Trying to play sound with invalid sound property. Duration is zero or negative.");return}if(currentSound&&currentSound.persist){return}currentSound=soundObj;audioElement.currentTime=currentSound.startTime;PBS.KIDS.storybook.log("Play Sound: "+currentSound.startTime+" -> "+currentSound.endTime+" (loop: "+currentSound.loop+", audioElement.currentTime: "+audioElement.currentTime);audioElement.play();if(!completeInterval){completeInterval=GLOBAL.setInterval(checkIfComplete,100)}};that.stop=function(){endSound()};that.load=function(){if(!loadStarted){loadStarted=true;load()}},that.destroy=function(){audioElement=null};that.getElement=function(){return audioElement};that.getLoadPercentage=function(){return loadPercentage};that.getSound=function(){return currentSound};if(init()){return that}else{return false}};PBS.KIDS.storybook.sound=function(startTime,endTime,options){"use strict";var that={};that.loop=options&&options.loop?options.loop:false;that.name=options&&options.name?options.name:null;that.persist=options&&options.persist?options.persist:false;that.startTime=startTime;that.endTime=endTime;return that};PBS.KIDS.storybook.makeAudible=function(GLOBAL,PBS,audioPlayer,view,sound){"use strict";var sb=PBS.KIDS.storybook,playing=false,press=function(e){audioPlayer.play(sound)};view.silent=function(){audioPlayer.stop()};view.addEventListener("PRESS",press);return view};